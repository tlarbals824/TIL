# 19장 도커를 이용한 로그 생성 및 관리

* 도커를 이용한 로그는 도커가 표준 출력 스트림을 통해 로그를 수집하기에 애플리케이션의 로그가 표준 출력 스트림으로 출력되고 있는지 확인하면 됩니다.

## 19.1 표준 에러 스트림과 표준 출력 스트림

* 도커 이미지는 애플리케이션 바이너리 및 의존성, 그리고 컨테이너를 시작할 때 도커가 실행할 프로세스에 대한 정보 등을 담은 파일 시스템의 스냅샷입니다.
* 컨테이너를 시작할 때 실행되는 프로세스는 포어그라운드로 동작합니다.
* 도커는 각 컨테이너의 stdout, stderr 스트림을 수집합니다.
* 터미널 세션과 분리된 컨테이너와 종료된 컨테이너의 로그를 수집할 수 있도록 로그를 JSON 파일로도 저장합니다. 이 파일은 컨테이너가 제거되면 함께 제거됩니다.

## 19.2 다른 곳으로 출력된 로그를 stdout 스트림에 전달하기

* 컨테이너화하더라도 출력 스트림으로 아무 내용도 출력하지 않는 애플리케이션의 경우 표준 로그 모델을 적용하기 어려운 경우도 있습니다.
* 도커는 표준 출력 스트림 외의 싱크로부터 로그를 수집할 수 없습니다.
* 앞선 애플리케이션의 경우 로그를 수집하기 위해서는, 로그 파일의 내용을 읽어 표준 출력으로 내보내 주는 별도의 프로세스를 컨테이너 시작 명령에서 실행하면 됩니다.
* 이는 로그 프로세스가 종료되면 애플리케이션과 함께 컨테이너까지 종료되는 문제가 있을 수 있어 세심하게 작성해야 합니다. 또한 디스크 사용 효율이 떨어지게 됩니다.

## 19.3 컨테이너 로그 수집 및 포워딩하기

* 컨테이너의 내용물과 상관없이 어떤 환경에서든 컨테이너를 다루는 방법이 같은 특성으로인해 애플리케이션 아키텍처에 통합 로깅 시스템을 도입할 때 유용합니다.
* fluentd는 통합 로깅 계층입니다. 통합 로깅 계층은 다양한 곳에서 생성되는 로그를 모으고, 필터링과 가공을 거쳐 다시 여러 대상으로 수집된 로그를 포워딩하는 역할을 합니다.
* fluentd를 컨테이너로 실행하고 다른 컨테이너에서 일반적인 JSON 파일 대신 fluentd 로깅 드라이버를 사용하도록 하면, 컨테이너에서 생성된 로그가 fluentd 컨테이너로 전달됩니다.
* fluentd는 수집한 로그에 자체 메타데이터를 추가해 저장합니다. 이 메타데이터에는 컨테이너 ID와 이름등이 포합됩니다. 이는 로그 컨텍스트를 파악하기 위해 사용됩니다.
* 수집된 로그는 NoSQL과 같은 로그 데이터 스토어에 전송됩니다.

## 19.4 로그 출력 및 로그 컬렉션 관리하기

* 도커의 유연한 로깅 모델을 이용하면 컨테이너에서는 상세한 로그를 생산하면서 로그를 저장할 때는 필터링을 적용할 수 있어 로그를 관리하는데 도움이 됩니다.

## 19.5 컨테이너의 로깅 모델

* 도커의 로깅 모델의 유연성은 애플리케이션 로그를 컨테이너 로그로 내보낼 때만 적용됩니다.
* 애플리케이션 로그를 컨테이너 로그로 내보내려면, 애플리케이션에서 로그를 stdout 스트림에 직접 출력하는 방법과 별도의 전달 유틸리티를 경유해 stdout 스트림으로 내보내는 방법을 사용할 수 있습니다.

