# 11장 도커와 도커 컴포즈를 이용한 애플리케이션 빌드 및 테스트

* CI는 정기적으로 반복되며 애플리케이션을 빌드하고 일련의 테스트를 수행하는 절차입니다.
* 도커를 통해 CI 작업의 대부분을 간소화할 수 있습니다.

## 11.1 도커를 이용한 지속적 통합 절차

* 모든 도커 프로젝트는 똑같은 단계를 거쳐 똑같은 유형의 결과물을 생성하기에 CI 절차의 일관성을 유지해줍니다.
* 도커화된 CI 절차에서는 모든 일이 컨테이너 안에서 진행됩니다. 이러한 작업을 위해서 중앙 집권적인 형상 관리 시스템, 이미지를 저장할 도커 레지스트리, CI 작업을 수행할 자동화 서버 등 인프라 요소가 필요합니다.

## 11.2 도커를 이용한 빌드 인프라스트럭처 구축하기

* 전체 CI 파이프라인이 도커 컨테이너를 통해 실행되므로 도커에서 실행된 컨테이너는 도커 API, 그리고 같은 도커 엔진에서 실행된 컨테이너와 연결됩니다.
* 도커 CLI는 기본적으로 로컬 컴퓨터에서 실행 중인 도커 API에 접속을 시도합니다. 또한 CLI가 컨테이너 안에서 실행됐다면 실제 통신은 호스트 컴퓨터의 소켓이나 명명된 파이프를 통해 이뤄집니다.
* 동작 중인 도커의 모든 기능에 접근 가능하다는 점은 보안 문제가 생길 수 있습니다. 따라서 신뢰할 수 있는 도커 이미지에만 적용해야 합니다.

## 11.3 도커 컴포즈를 이용한 빌드 설정

* 도커 컴포즈에서 환경 변수 설정시 :-을 사용한다면 기본값을 지정할 수 있습니다.
* 도커 컴포즈로 애플리케이션을 빌드하는 과정은 실질적으로 정의된 각 서비스마다 docker image build 명령을 실행하는 과정입니다.
* 컨테이너, 이미지, 네트워크 볼륨 등 대부분의 도커 리소스에는 레이블을 부여할 수 있습니다. 레이블은 이미지에 포함시킬 수 있다는 점에서 이미지와 함께 사용할 때 특히 유용합니다.
* 이미지 레이블을 통해 CI 파이프라인을 통한 애플리케이션 빌드 과정을 추적할 수 있습니다.
* LABEL 인스트럭션은 Dockerfile 스크립트에 정의된 키-값 쌍을 빌드되는 이미지에 적용해 줍니다.
* ARG 인스트럭션은 이미지 빌드하는 시점에만 유효하다는 점을 제외하면 ENV 인스트럭션과 거의 같습니다. 이는 이미지 레이블에 들어갈 값을 제공하기 위해 사용합니다.

## 11.4 도커 외의 의존 모듈이 불필요한 CI 작업 만들기

* 컨테이너에서 수행하는 CI의 주된 장점으로는 의존 모듈이 별도로 필요하지 않는 다는 점이 있습니다.

## 11.5 CI 파이프라인에 관계된 컨테이너

* 도커를 사용하면 애플리케이션 빌드 프로세스의 최상위 레이어가 항상 동일해집니다. 이를통해 CI 파이프라인에 다양하고 유용한 기능을 추가할 수 있습니다.
* CI 파이프라인에 추가된 모든 검증 단계는 컨테이너와 이미지를 대상으로하기에 전체 애플리케이션 플랫폼도 그대로 유효합니다.