# 9장 컨테이너 모니터링으로 투명성 있는 애플리케이션 만들기

* 컨테이너에서 실행하는 애플리케이션에 있어 투명성은 매우 중요한 요소입니다.

## 9.1 컨테이너화된 애플리케이션에서 사용되는 모니터링 기술 스택

* 전통적인 애플리케이션 모니터링은 서버의 목록과 현재 동작 상태가 표시된 대시보드가 있고 과부하 걸리거나 응답하지 않는 서버가 발생하면 경보가 울리는 형태가 대표적입니다.
* 프로메테우스는 컨테이너 환경에서 실행 중인 애플리케이션을 속속들이 들여다볼 수 있는 도구를 갖춘 모니터링을 제공합니다.
* 프로메테우스를 사용하면 모니터링의 중요한 측면인 일관성이 확보됩니다.
* 프로메테우스는 도커 엔진의 측정값도 같은 형식으로 추출할 수 있습니다.

## 9.2 애플리케이션의 측정값 출력하기

* 프로메테우스 클라이언트 라이브러리를 통해 수집된 정보는 런타임 수준의 측정값입니다.
* 애플리케이션에서 명시적으로 특정 정보를 생성하는 코드를 작성한다면 프로메테우스 클라이언트를 통해 수집할 수 있습니다.

## 9.3 측정값 수집을 맡을 프로메테우스 컨테이너 실행하기

* 프로메테우스는 직접 측정값을 대상 시스템에서 받아다 수집하는 풀링 방식으로 동작합니다. 이 과정을 스크래핑이라고 합니다.
* 프로메테우스를 실행하면 스크래핑 대상 엔드포인트를 설정해야 합니다.
  * 운영 환경의 컨테이너 플랫폼에서는 클러스터에 있는 모든 컨테이너를 찾도록 설정할 수 있습니다.
  * 단일 서버의 도커 컴포즈 환경에서는 서비스 목록으로 도커 네트워크의 DNS를 통해 대상 컨테이너를 자동으로 찾습니다.
* 레이블을 붙여 측정값에 정보를 추가하는 기능은 프로메테우스의 기능 중에서도 가장 강력한것 중 하나입니다.

## 9.4 측정값 시각화를 위한 그라파나 컨테이너 실행하기

* 프로메테우스를 통해 측정값을 열람하거나 데이터 시각화를 위한 쿼리를 확인하고 손보며 이 쿼리를 연결해 대시보드를 구성하는 데는 그라파나를 사용합니다.
* 그라파나 대시보드는 애플리케이션의 핵심 정보를 다양한 수준에서 제공합니다.

## 9.5 투명성의 수준

* 간단한 개념 검증 수준의 프러덕트에서 실제 서비스가 가능한 수준으로 나아가기 위해서는 투명성이 반드시 필요합니다.
* 가장 중요한 것은 애플리케이션의 전체 상황을 조망하는 대시보드입니다.
* 측정값 중에서 애플리케이션에 중요한 데이터를 모아 하나의 화면으로 구성할 수 있어야 합니다.

~~~
version: "3.7"

services:
  todo-list:
    image: diamol/ch09-todo-list
    ports:
      - "8050:80"
    networks:
      - app-net

  prometheus:
    image: diamol/ch09-lab-prometheus
    ports:
      - "9090:9090"
    networks:
      - app-net

  grafana:
    image: diamol/ch09-lab-grafana
    ports:
      - "3000:3000"
    depends_on:
      - prometheus
    networks:
      - app-net

networks:
  app-net:
    external:
      name: nat
~~~