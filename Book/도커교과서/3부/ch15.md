# 15장  보안 원격 접근 및 CI/CD를 위한 도커 설정

* 도커 엔진과 API를 분리함으로써 다음과 같은 장점이 있습니다.
  * 다른 도구로도 도커 API를 사용할 수 있어 컨테이너를 관리하는 도구의 선택지가 넓어집니다.
  * 로컬 컴퓨터에 있는 명령행 도구로도 원격 컴퓨터에서 실행 중인 도커 엔진을 관리할 수 있습니다.

## 15.1 도커 API의 엔드포인트 형태

* 도커 엔진을 원격에 접근할 수 있게 하기위해 명시적으로 외부 접근을 허용해야하며, 원격 접근이 가능한 채널들을 선택해서 접근해야 합니다.
* 도커 엔진에 비보안 HTTP 접근을 허용하게 되면 악의적인 요청을 보내어 도커 엔진을 공격할 수 있습니다.

## 15.2 보안 원격 접근을 위한 도커 엔진 설정

* 도커에는 API가 요청을 받아들일 수 있는 보안 채널로는 두가지 있습니다.
  * 전송 계층 보안(TLS)으로, HTTPS 프로토콜의 디지털 인증서와 같은 방식의 암호화를 사용합니다. 도커 API는 상호 TLS를 사용하므로 서버와 클라이언트 각각 인증서를 가집니다.
  * 보안 셸(SSH) 프로토콜으로, 리눅스 서버에 원격 접속하는 표준 프로토콜이며 윈도우에서도 사용가능합니다.
* 어떤 보안 채널을 사용하느냐에 따라 클러스터에 접근할 권할을 부여하는 방법이 달리집니다.
  * TLS는 널리 사용되는 방법이지만 인증서를 생성하고 교체하는 관리 업무에서 오버헤드가 발생합니다.
  * SSH는 SSH 클라이언트만 있으면 되기에 접근 권한 관리가 생대적으로 쉽습니다.
* TLS를 통해 도커 엔진에 접근하기 위해서는 인증 기관과 한 쌍의 인증서가 필요합니다.
* SSH의 경우 도커 명령행 도구가 표준 SSH 클라이언트를 사용하기에 도커 엔진 설정을 변경할 필요가 없습니다.
* 도커 엔진 원격 접근에 TLS와 SSH을 적용하면 암호화와 사용자 인증이 함께 적용되지만, 보안 접속에 권한 조정이나 감시 기능이 포함돼 있지 않기에 사용자 접근에 대한 추적을 할 수 없습니다.

## 15.3 도커 컨텍스트를 사용해 원격 엔진에서 작업하기

* 도커 컨텍스트를 사용하면 원격으로 접근할 도커 엔진을 편리하게 전환할 수 있습니다.
* 도커 컨텍스트는 도커 명령행 도구에서 원격 접근에 필요한 모든 상세 정보를 지정하면 생성할 수 있습니다.
* 컨텍스트는 여러 개를 만들 수도 있으며 원격 접근에 필요한 상세 정보는 모두 로컬 컴퓨터에 저장됩니다.
* 컨텍스트에는 로컬 엔진이나 원격 엔진 간에 대상을 전환하기 위해 필요한 모든 정보가 들어갑니다.
* 컨텍스트를 전환하는 방법은 두가지 입니다.
  * 해당 터미널 세션에만 적용되는 임시적인 전환
  * 이후 다른 컨텍스트로 다시 전환할 때까지 다른 터미널 세션에도 모두 적용되는 영구적인 전환
* docker context use 명령은 컨텍스트를 영구적으로 전환되기에 시스템 전체에 영향을 미칩니다.

## 15.4 지속적 통합 파이프라인에 지속적 배포 추가하기

* 지속적 배포 단계는 지속적 통합에 추가적으로 테스트 환경에 애플리케이션을 배포한 후 최종 배포 인가를 받고 운영 환경까지 배포하는 단계를 말합니다.
* CI 빌드는 처음부터 끝까지 빌드용 서버의 도커 엔진 안에서만 진행될 수 있지만, 배포는 원격 도커 엔진에서 진행할 필요가 있습니다.
* 파이프라인에서 도커 명령행이 하는 일과 도커 컴포즈 명령행이 하는 일, 그리고 이 두 가지 일을 제어하는 일을 잘 분리해 둬야 합니다. 그래야지 특정 자동화
서버를 전환할 때 도움이 됩니다.

## 15.5 도커 리소스의 접근 모델

* 도커 엔진의 보안은 두 가지를 의미합니다.
  * 명령행 도구와 API 사이의 통신을 암호화하는 것입니다.
  * 허가받은 사용자만이 API에 접근할 수 있도록 하는 것입니다.
* 도커 엔진은 권한을 조정하는 기능은 없습니다. 모든 것을 할 수 있거나 아무것도 할 수 없거나입니다.
* 쿠버네티스에는 도커 엔터프라이즈와 마찬가지로 역할 기반 접근 제어 모델이 있어 어떤 사용자가 접근할 수 있는 리소스는 무엇이고 이들 리소스에 어떤 작업을 수행할 수 있는지 세세하게 지정할 수 있습니다.
* CI/CD 파이프라인의 주체가 바뀐 GitOps적인 접근법도 있습니다.
* GitOps는 Git을 통해 애플리케이션 배포를 관리하는 접근법입니다.
* GitOps는 애플리케이션 소스뿐만아닌 배포에 사용되는 yaml 파일의 버전, 인프라스트럭처 설정 스크립트까지 버전 관리의 대상이 됩니다.