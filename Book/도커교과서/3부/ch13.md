# 13장 도커 스웜 스택으로 분산 애플리케이션 배포하기

* 도커 스웜과 쿠버네티스 모두 yaml을 이용하여 원하는 상태를 만들지만 두 도구가 사용하는 yaml의 문법은 조금씩 다릅니다.

## 13.1 도커 컴포즈를 사용한 운영 환경

* 도커 스웜은 컴포즈를 만날 때 진정한 위력을 발휘합니다. 운영 환경에서 개발 및 테스트 환경과 동일한 파일 포맷을 사용할 수 있기 때문입니다.
* 스웜에서 가장 간단한 형태의 배포는 컴포즈 파일 그 자체입니다.
* 스웜 모드에서는 애플리케이션을 배포할 때 스택을 만들며, 스택은 서비스, 네트워크, 볼륨 등 여러 개의 도커 리소스를 묶어 만든 리소스를 말합니다.
* 스택은 스웜 모드의 일급 리소스입니다.
* 도커 컴포즈 파일에 deploy를 통해 스웜 모드에서 사용할 수 있는 다양한 옵션을 지정할 수 있습니다.
* 스웜 스택에 업데이트를 적용하는 방법도 애플리케이션을 배포하는 방법과 같습니다. 수정된 yaml 파일을 매니저 노드에 전달하면 그 내용 그대로 애플리케이션에 반영됩니다.
* 스웜 스택을 애플리케이션을 그룹화하는 방법으로 활용됩니다.
* 클러스터 데이터베이스에 애플리케이션에 대한 모든 정의가 들어 있기에 따로 컴포즈 파일이 없더라도 스택의 모든 리소스를 관리할 수 있습니다.

## 13.2 컨피그 객체를 이용한 설정값 관리

* 컨테이너에서 실행된 애플리케이션은 설정값을 컨테이너를 실행한 플랫폼에서 받아 와야 합니다.
* 애플리케이션 설정은 모든 컨테이너 오케스트레이션 도구가 전용 1등급 리소스를 따로 마련해 둘만큼 중요한 요소입니다.
* 스웜에서는 설정값을 위해 도커 컨피그 객체가 쓰입니다.
* 컨피그 객체는 컨테이너가 설정값을 클러스터에서 읽어 올 수 있게 해 주는 강력한 기능을 가진 리소스이자 애플리케이션 배포와 설정 관리를 분리해 주는 역할도 합니다.
* 컨피그 객체는 스웜에 의해 컨테이너 파일 시스템 내의 파일로서 전달됩니다.
* 컨피그 객체는 암호화되지 않기에 컨피그 객체는 민감한 데이터를 보관하기 위한 수단이 아닙니다.
* 민감한 데이터는 컨피그 객체에 보관해서는 안 됩니다.

## 13.3 비밀값을 이용한 대외비 설정 정보 관리하기

* 비밀값은 클러스터의 관리를 받는 스웜 리소스 입니다.
* 비밀값은 컨피그 객체와 전달방법은 비슷하지만 차이점으로는 데이터의 함호화 복화하에서 차이가 납니다. 비밀값이 전달된 상태에서 컨테이너에서 복호화된 비밀값을 볼 수 있습니다. 그 외에는 암호화된 상태로 존재합니다.
* 컨피그 객체와 비밀값은 수정이 불가능합니다. 하지만 쿠버네티스의 경우 변경할 수 있습니다.

## 13.4 스웜에서 볼륨 사용하기

* 볼륨은 마치 컨테이너 파일 시스템의 일부처럼 사용 가능하지만, 사실은 컨테이너 외부에 존재하는 리소스입니다.
* 오케스트레이션 플랫폼에서도 볼륨의 개념은 같습니다.
* 컴포즈 파일의 서비스 정의에 볼륨 마운트를 정의하면, 레플리카에서 볼륨을 로컬 파일 시스템의 디렉터리처럼 사용할 수 있습니다.
* 오케스트레이션에서 하나의 레플리카를 다른 새로운 레플리카로 교체하는 과정에서 기존 레플리카가 사용하던 로컬 볼륨에 접근할 수 없는 문제가 있습니다.
* 앞선 문제를 해결하기 위해서는 서비스가 데이터가 있는 특정 노드에서만 실행되게끔 고정해야 합니다.
* 서비스 정의대로 배포한 애플리케이션은 스택을 제거하더라도 레이블이 붙은 노드 자체가 남아 있기만 하면 데이터를 유실하지 않습니다.
* 도커는 볼륨 드라이버에 플러그인 시스템을 채용하고 있어 스웜에서 클라우드 스토리지나 데이터센터의 스토리지 장비를 분산 스토리지로 사용하게끔 설정할 수 있습니다.

## 13.5 클러스터는 스택을 어떻게 관리하는가?

* 도커 스웜에서 말하는 스택은 클러스터가 관리를 담당하는 리소스의 모임입니다.
* 스웜도 볼륨을 생성하고 삭제할 수 있습니다.
* 비밀값과 컨피그 객체는 설정값이 든 파일을 클러스터에 업로드하는 방법으로 생성합니다.
* 네트워크는 애플리케이션과 별도로 관리됩니다.
* 서비스는 스택이 배포될 때 생성되거나 제거됩니다.
* 스택은 애플리케이션을 구성하는 요소를 모아 놓은 논리적 객체입니다. 하지만 스택에는 서비스 간의 의존 관계를 정의하는 기능이 없습니다.