# 11장 보안

## 11.1 보안 설정 적용하기

* 인증은 사용자가 누구인지 식별한다.
* 인가는 사용자가 무엇을 할 수 있는지 결정한다.
* 암호화는 누설과 위조로부터 데이터를 보호한다.
* 감사는 사용자가 무엇을 했는지, 하려 했는지를 추적한다.
* 쿼터는 자원을 얼마나 많이 사용할 수 있는지를 조절한다.

## 11.2 보안 프로토콜

* 카프카는 클라이언트로붵 연결을 받는 리스너가 존재하는데, 이 리스터 각자는 보안 설정을 가질 수 있다.
* 카프카는 TLS와 SASL을 통해 4개의 보안 프로토콜을 지원한다.
  * PLAINTEXT: PLAINTEXT 전송 계층에는 인증이 존재하지 않음
  * SSL: 선택적으로 클라이언트 SSL 인증을 수행할 수 있다.
  * SASL_PLAINTEXT: SASL 인증과 PLAINTEXT 전송 계층을 사용한다.
  * SASL_SSL: SASL 인증과 SSL 전송 계층을 사용한다.

## 11.3 인증

* 인증은 서버와 클라이언트의 사이에서 서로의 신원을 확인하는 과정이다.

### 11.3.1 SSL

* TLS를 통해 연결을 진행하면, TLS 핸드세이크 과정에서 인증, 암호 암호화 매개변수 교환, 암호화를 위한 공유 키 생성 등이 처리된다.

### 11.3.2 SASL

* SASL과 TLS를 함께 사용함으로써 인증과 암호화를 동시에 지원하는 안전한 채널을 사용할 수 있다.
* SASL 인증은 서버가 챌린지를 내놓으면 클라이언트가 여기에 응답을 보내는 과정을 일정한 순서로 수행하는 식으로 수행된다.

## 11.4 암호화

* 암호화는 데이터의 기밀성과 무결성을 보장하기 위해 사용된다.
* 카프카 로그를 저장하는 디스크에 대해 물리적으로 접근할 수 있는 사용자라도 민감한 데이터를 열어볼 수 없도록 데이터를 완전히 보고하기 위해서는 암호화를 사용해야 한다.

### 11.4.1 종단 암호화

* 카프카는 데이터를 전송하는 과정에서 암호화를 지원한다.
* 카프카에서는 키 관리 시스템에 공유 키를 저장함으로써 프로듀서는 암호화, 컨슈머는 복호화를 진행할 수 있다.
* 키는 주기적으로 갱신되어야 하며, 이를 위해 카프카는 키 관리 시스템을 지원한다.

## 11.6 감사

* 감사와 디버깅을 목적으로 상세한 log4j 로그를 생성하돌고 설정할 수 있다.

## 11.7 주키퍼 보안

* 주키퍼는 카프카 클러스터의 메타데이터를 저장하고 관리한다. 따라서 주키퍼에 대한 접근을 제한하는 것이 중요하다.

## 11.8 플랫폼 보안

* 개별 보안요소 뿐만 아니라 전체 시스템에 대한 위협 모델을 고려해야 한다.
* 위협 모델은 시스템을 추상화하고 여기에 대한 잠재적인 위협과 수반되는 위험 요소를 식별한다.

## 11.9 요약

* 클라이언트 진정성
  * SASL, SSL 을 통해 클라이언트 진정성을 보장할 수 있다.
* 서버 진정성
  * 상호 인증 기능을 통해 서버 진정성을 보장할 수 있다.
* 기밀성
  * SSL을 통해 데이터의 기밀성을 보장할 수 있다.
* 무결성
  * SSL을 통해 데이터의 무결성을 보장할 수 있다.
* 접근 제어
  * ACL을 통해 접근 제어를 할 수 있다.
* 감사 가능성
  * 감사와 이상 탐지를 목적으로 상세한 로그를 생성할 수 있다.
* 가용성
  * 쿼터와 연결 관리 설정 옵션을 조합함으로서 가용성을 보장할 수 있다.
