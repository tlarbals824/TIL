# 7장 분산 시스템을 위한 유일 ID 생성기 설계

## 다중 마스터 복제

다중 마스터 복제는 데이터베이스의 auto_increment를 활용합니다. 다만, 데이터베이스의 수 K만큼 값이 증가되도록 구성합니다.

이렇게 id값을 생성하면 유일한 키 값을 생성할 수 있지만 다음과 같은 문제가 발생합니다.

* 데이터베이스를 확장/축소할 때, 데이터 분산에 어려움이 있음
* id가 시간이 증가함에 따라 커지는걸 보장하기 어려움


## UUID

UUID는 유일성이 보장되는 ID를 만드는 하나의 방법입니다. 

UUID는 텀퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위한 128비트 수입니다. 즉, 충돌 가능성이 지극히 낮습니다.

UUID를 사용할 때의 장단점은 다음과 같습니다.

* 장점: 생성하기 단순하며, 서버간 조율이 필요 없어 동기화 이슈도 없습니다. 즉, 확장성이 좋습니다.
* 단점: id가 128비트로 너무 길고, 시간순으로 정렬할 수 없습니다. 다만 v7을 사용하면 시간순으로 정렬 가능합니다.

## 티켓 서버

티켓 서버는 유일성이 보장되는 ID를 만들어 내는 데 사용할 수 있습니다. 이를 위해 auto_increment만을 담당하는 서버를 두고, 각 서버들이 해당 서버에서 id를 발급받아 사용하게 됩니다.

장점은 유일성이 보장되는 id를 발급받을 수 있고, 구현하기 쉽습니다.

단점으로는 단일 장애 지점이 될 수 있으며, 이를 방지하기 위해 여러 티켓 서버를 구축해야할 수 있습니다. 하지만, 여러 서버를 구축할 때 서버간 동기화가 필요합니다.

## 트위터 스노플레이크 접근법

생성할 ID의 비트 구성은 다음과 같습니다.

* 사인(sign) 비트: 1비트를 사용합니다. 일반적으로 0으로 고정합니다. 그 이유는 64비트에 대한 타입을 지정할 때, unsigned 또는 signed에 대한 구분이 필요없도록하기 위함입니다.
* 타임스탬프(timestamp): 41비트를 할당합니다. 리눅스 에포크 시간을 저장합니다.
* 데이터 센터 ID: 5비트를 할당합니다.
* 서버 ID: 5비트를 할당합니다. 센터당 32개의 서버를 할당할 수 있습니다.
* 일련번호: 12비트를 할당합니다. 가가 서버에서 ID를 생성할때마다 1씩 증가합니다. 다만 1밀리초 내에서만 유효하기 때문에 각 밀리초가 시작될 때 0으로 초기화됩니다.