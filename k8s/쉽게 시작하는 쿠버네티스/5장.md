# 5장

## 팟 제거

* 팟만 생성된 경우 팟을 지우면 다 지워짐. 하지만, deployment를 통해 팟이 생성되고 생성된 팟을 지우면 다시 생성해줌

```                 
root@cp-k8s:~# kubectl apply -f ./_Lecture_k8s_starter.kit/ch5/5.1
deployment.apps/del-deploy created
pod/del-pod created
root@cp-k8s:~# kubectl get pod
NAME                         READY   STATUS              RESTARTS   AGE
del-deploy-d6c48dfbf-g46px   1/1     Running             0          4s
del-deploy-d6c48dfbf-skwrt   1/1     Running             0          4s
del-deploy-d6c48dfbf-xvqqd   1/1     Running             0          4s
del-pod                      0/1     ContainerCreating   0          4s
root@cp-k8s:~# kubectl get deployment
NAME         READY   UP-TO-DATE   AVAILABLE   AGE
del-deploy   3/3     3            3           9s
root@cp-k8s:~# kubectl delete pod del-pod
pod "del-pod" deleted
root@cp-k8s:~# kubectl get deployment
NAME         READY   UP-TO-DATE   AVAILABLE   AGE
del-deploy   3/3     3            3           32s
root@cp-k8s:~# kubectl get pod
NAME                         READY   STATUS    RESTARTS   AGE
del-deploy-d6c48dfbf-g46px   1/1     Running   0          34s
del-deploy-d6c48dfbf-skwrt   1/1     Running   0          34s
del-deploy-d6c48dfbf-xvqqd   1/1     Running   0          34s
root@cp-k8s:~# kubectl delete pod del-deploy-d6c48dfbf-g46px
pod "del-deploy-d6c48dfbf-g46px" deleted
root@cp-k8s:~# kubectl get pod
NAME                         READY   STATUS    RESTARTS   AGE
del-deploy-d6c48dfbf-6w7kp   1/1     Running   0          3s
del-deploy-d6c48dfbf-skwrt   1/1     Running   0          44s
del-deploy-d6c48dfbf-xvqqd   1/1     Running   0          44s
root@cp-k8s:~# kubectl get pod
NAME                         READY   STATUS    RESTARTS   AGE
del-deploy-d6c48dfbf-6w7kp   1/1     Running   0          6s
del-deploy-d6c48dfbf-skwrt   1/1     Running   0          47s
del-deploy-d6c48dfbf-xvqqd   1/1     Running   0          47s
root@cp-k8s:~# kubectl delete deployment del-deploy
deployment.apps "del-deploy" deleted
root@cp-k8s:~# kubectl get pod
No resources found in default namespace.
root@cp-k8s:~# kubectl get deployment
No resources found in default namespace.
root@cp-k8s:~# 
```

## kutelet이 중단된다면

* w1-k8s 중단 상황

```
root@cp-k8s:~# kubectl apply -f ./_Lecture_k8s_starter.kit/ch5/5.1/del-deploy.yaml 
deployment.apps/del-deploy created
root@cp-k8s:~# kubectl get pod
NAME                         READY   STATUS    RESTARTS   AGE
del-deploy-d6c48dfbf-7krq6   0/1     Pending   0          5s
del-deploy-d6c48dfbf-l2dbw   1/1     Running   0          5s
del-deploy-d6c48dfbf-mvfzq   1/1     Running   0          5s
root@cp-k8s:~# kubectl get pod -o wide
NAME                         READY   STATUS    RESTARTS   AGE   IP               NODE     NOMINATED NODE   READINESS GATES
del-deploy-d6c48dfbf-7krq6   0/1     Pending   0          11s   <none>           w1-k8s   <none>           <none>
del-deploy-d6c48dfbf-l2dbw   1/1     Running   0          11s   172.16.132.6     w3-k8s   <none>           <none>
del-deploy-d6c48dfbf-mvfzq   1/1     Running   0          11s   172.16.103.134   w2-k8s   <none>           <none>
root@cp-k8s:~# 
```

## 컨테이너 런타임이 문제가 생기면

```
root@cp-k8s:~# kubectl scale deployment del-deploy --replicas=6
deployment.apps/del-deploy scaled
root@cp-k8s:~# kubectl get pods
NAME                         READY   STATUS              RESTARTS   AGE
del-deploy-d6c48dfbf-695sq   1/1     Running             0          4s
del-deploy-d6c48dfbf-7krq6   1/1     Running             0          2m33s
del-deploy-d6c48dfbf-8v924   1/1     Running             0          4s
del-deploy-d6c48dfbf-f4ljd   0/1     ContainerCreating   0          4s
del-deploy-d6c48dfbf-l2dbw   1/1     Running             0          2m33s
del-deploy-d6c48dfbf-mvfzq   1/1     Running             0          2m33s
root@cp-k8s:~# kubectl get pods -o wide
NAME                         READY   STATUS    RESTARTS   AGE     IP               NODE     NOMINATED NODE   READINESS GATES
del-deploy-d6c48dfbf-695sq   1/1     Running   0          9s      172.16.132.7     w3-k8s   <none>           <none>
del-deploy-d6c48dfbf-7krq6   1/1     Running   0          2m38s   172.16.221.133   w1-k8s   <none>           <none>
del-deploy-d6c48dfbf-8v924   1/1     Running   0          9s      172.16.103.135   w2-k8s   <none>           <none>
del-deploy-d6c48dfbf-f4ljd   1/1     Running   0          9s      172.16.132.8     w3-k8s   <none>           <none>
del-deploy-d6c48dfbf-l2dbw   1/1     Running   0          2m38s   172.16.132.6     w3-k8s   <none>           <none>
del-deploy-d6c48dfbf-mvfzq   1/1     Running   0          2m38s   172.16.103.134   w2-k8s   <none>           <none>
root@cp-k8s:~# 
```

## 스케쥴러의 재배포 동작

* 배포에서 컨테이너는 최대한 균등하게 분배됨
* 컨테이너 런타임이 다운되더라도 즉각 인지되지 않고, 어느 일정 이후 인지됨

## 쿠버네티스 마스터 노드 구성 요소에 문제가 생긴다면

* 문제가 생기면 다시 생성함
* 마스터 노드의 kubelet이 문제가 생기면 마스터 노드의 구성 요소에 명령어가 전달되지 않음. 따라서 구성요소에 문제가 생기지 않는 이상 전체적으로 문제가 발생하지 않음
* docker -> containerd로 옮기면서 서비스 안전성이 높아짐