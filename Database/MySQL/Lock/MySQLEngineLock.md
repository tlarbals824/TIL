# MySQL 엔진 락

## 글로벌 락(Global Lock)

* 글로벌 락은 전체 데이터베이스를 대상으로하는 락입니다. MySQL에서 제공하는 락 가운데 가장 범위가 큽니다.
* 글로벌 락은 **"FLUSH WITH READ LOCK"** 명령어로 획득할 수 있습니다.
* 한 세션에서 글로벌 락을 획득하면 다른 세션에서 SELECT를 제외한 대부분의 DDL 문장이나 DML 문장을 실행하는 경우 글로벌 락이 해제될 때까지 해당 문장이 대기 상태로 남습니다.
* 여러 데이터베이스에 존재하는 MyISAM이나 MEMORY 테이블에 대해 mysqldump로 일관된 백업을 받아야 할 때는 글로벌 락을 사용해야 합니다.
* InnoDB에서 좀 더 가벼운 락인 백업 락이 도입됐습니다. 백업 락은 글로벌 락과는 다르게 일반적인 테이블의 데이터 변경은 허용됩니다.

## 테이블 락(Table Lock)

* 테이블 락은 개별 테이블 단위로 설정되는 락이며, 명시적 또는 묵시적으로 특정 테이블의 락을 획득할 수 있습니다.
* 테이블 락은 MyISAM뿐만 아니라 InnoDB 스토리지 엔진을 사용하는 테이블도 동일하게 설정할 수 있습니다.
* 명시적으로는 **"LOCK TABLES table_name [ READ | WRITE ]"** 명령으로 특정 테이블의 락을 획득할 수 있습니다. 이는 **"UNLOCK TABLES"** 를 통해 락을 반납할 수 있습니다.
* 묵시적인 테이블 락은 MyISAM이나 MEMORY 테이블에 데이터를 변경하는 쿼리를 실행하면 발생합니다. 데이터 변경이 완료되면 즉시 락을 해제합니다.
* InnoDB 테이블에 경우 스토리지 엔진 차원에서 레코드 기반의 잠금을 제공하기에 단순 데이터 변경(DML) 쿼리로 인해 묵시적인 테이블 락이 설정되지 않습니다. 반면 스키마를 변경하는 쿼리(DDL)에 경우에는 영향을 미칩니다. 

## 네임드 락(Named Lock)

* 네임드 락은 **GET_LOCK()** 함수를 이용해 임의의 문자열에 대해 락을 설정할 수 있습니다. 또한 **RELEASE_LOCK()** 함수를 이용하여 락을 해제할 수 있습니다.
* 네임드 락은 대상이 테이블이나 레코드 또는 AUTH_INCREMENT와 같은 데이터베이스 객체가 아니라는 것입니다.
* MySQL 8.0 버전부터 네임드 락을 중첩해서 사용할 수 있습니다. 또한 현재 세션에서 획득한 네임드 락을 한 번에 모두 해제하는 **RELEASE_ALL_LOCKS()** 함수가 추가 됐습니다.
* 네임드 락의 경우 애플리케이션에서 동시성 문제를 해결할 때 사용할 수 있습니다.
* 네임드 락의 경우 많은 레코드에 대해서 복잡한 요건으로 레코드를 변경하는 트랜잭션에 유용하게 사용할 수 있습니다.

## 메타데이터 락(Metadata Lock)

* 메타데이터 락은 데이터베이스 객체(대표적으로 테이블이나 뷰 등)의 이름이나 구조를 변경하는 경우에 획득하는 락입니다.
* 메타데이터 락은 명시적으로 획득하는 락이 아니며, 데이터베이스 객체의 이름이나 구조를 변경할 시 자동으로 획득할 수 있는 락입니다.
* InnoDB의 트랜잭션을 이용하면 메타데이터 락의 영향을 줄일 수 있습니다.
* 메타데이터 락이 발생하더라도 테이블 락이 같이 발생하지는 않습니다.

> 참조
>
> Real MySQL 8.0 1권(https://product.kyobobook.co.kr/detail/S000001766482)